generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

////////////////////////////////////////////////////////////
// ENUMS
////////////////////////////////////////////////////////////

enum VisibilityStatus {
  ACTIVE
  QUIET
  PAUSED
}

enum SeniorityLevel {
  JUNIOR
  MID
  SENIOR
  STAFF
  PRINCIPAL
}

enum ActivityType {
  TRACK_CREATED
  TRACK_UPDATED
  VISIBILITY_CHANGED
  ROLE_PREFERENCE_UPDATED
  MATCH_ADDED
  PROMPT_GENERATED
}

////////////////////////////////////////////////////////////
// USER (Auth-linked)
////////////////////////////////////////////////////////////

model User {
  id              String   @id @default(uuid())
  authUserId      String   @unique
  email           String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  tracks          CareerTrack[]
  activityLogs    ActivityLog[]
}

////////////////////////////////////////////////////////////
// CAREER TRACK (Core abstraction)
////////////////////////////////////////////////////////////

model CareerTrack {
  id               String   @id @default(uuid())
  userId           String
  title            String
  seniority        SeniorityLevel?
  location         String?
  yearsExperience  Int?
  visibility       VisibilityStatus @default(QUIET)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user             User @relation(fields: [userId], references: [id])
  rolePreferences  RolePreference[]
  pipelineLinks    PipelineMembership[]
  interviewPrompts InterviewPrompt[]

  @@map("career_track")
}

////////////////////////////////////////////////////////////
// ROLE PREFERENCES (Per track)
////////////////////////////////////////////////////////////

model RolePreference {
  id               String   @id @default(uuid())
  careerTrackId    String
  title            String
  location         String?
  remoteAllowed    Boolean  @default(false)
  createdAt        DateTime @default(now())

  careerTrack      CareerTrack @relation(fields: [careerTrackId], references: [id])
}

////////////////////////////////////////////////////////////
// HIRING POOLS (Abstract opportunity sets)
////////////////////////////////////////////////////////////

model HiringPool {
  id               String   @id @default(uuid())
  roleTitle        String
  companyName      String?
  location         String?
  createdAt        DateTime @default(now())

  memberships      PipelineMembership[]
}

////////////////////////////////////////////////////////////
// PIPELINE MEMBERSHIP (Track â†” Pool)
////////////////////////////////////////////////////////////

model PipelineMembership {
  id               String   @id @default(uuid())
  careerTrackId    String
  hiringPoolId     String
  addedAt          DateTime @default(now())

  careerTrack      CareerTrack @relation(fields: [careerTrackId], references: [id])
  hiringPool       HiringPool  @relation(fields: [hiringPoolId], references: [id])

  @@unique([careerTrackId, hiringPoolId])
}

////////////////////////////////////////////////////////////
// INTERVIEW PROMPTS (AI output)
////////////////////////////////////////////////////////////

model InterviewPrompt {
  id               String   @id @default(uuid())
  careerTrackId    String
  roleTitle        String
  prompt           String
  createdAt        DateTime @default(now())

  careerTrack      CareerTrack @relation(fields: [careerTrackId], references: [id])
}

////////////////////////////////////////////////////////////
// ACTIVITY LOG (Audit + analytics)
////////////////////////////////////////////////////////////

model ActivityLog {
  id               String   @id @default(uuid())
  userId           String
  type             ActivityType
  metadata         Json?
  createdAt        DateTime @default(now())

  user             User @relation(fields: [userId], references: [id])
}
